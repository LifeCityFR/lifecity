<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Déclaration d'identité - LifeCity</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --main-bg-color: #000;
            --main-text-color: #fff;
            --accent-color: #ffc107;
            --error-color: #ff4d4d;
            --success-color: #4caf50;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--main-bg-color);
            color: var(--main-text-color);
        }
        nav {
            background-color: #111;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        nav .logo {
            font-size: 24px;
            font-weight: bold;
            color: #ffc107;
        }
        header {
            background-image: url('https://policeroleplay.community/_next/static/media/splash-optimised.3a1b2560.gif');
            background-size: cover;
            background-position: center;
            text-align: center;
            padding: 100px 20px;
            color: #fff;
        }
        header h1 {
            font-size: 40px;
            margin: 0;
            font-weight: bold;
            text-transform: uppercase;
            animation: fadeInDown 2s;
        }
        header p {
            font-size: 20px;
            margin: 20px 0;
            animation: fadeInUp 2s;
        }
        .container {
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background-color: #222;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            animation: fadeIn 2s;
        }
        .section h2 {
            margin-top: 0;
            font-weight: bold;
            text-transform: uppercase;
        }
        .section h2 i {
            margin-right: 10px;
        }
        .job-details {
            display: flex;
            align-items: center;
        }
        .job-details img {
            max-width: 100px;
            margin-right: 20px;
            border-radius: 10px;
        }
        .form-section {
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            animation: fadeIn 2s;
        }
        .form-section h2 {
            margin-top: 0;
            font-weight: bold;
            text-transform: uppercase;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 5px;
            border: none;
            border-radius: 5px;
            background-color: #444;
            color: var(--main-text-color);
        }
        .form-group textarea {
            resize: vertical;
            height: 80px;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--main-bg-color);
            color: var(--main-text-color);
            border: 1px solid;
            border-radius: 5px;
            padding: 10px;
            display: none;
            align-items: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        .notification.success {
            border-color: var(--success-color);
        }
        .notification.error {
            border-color: var(--error-color);
        }
        .notification i {
            margin-right: 10px;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes bounceIn {
            from, 20%, 40%, 60%, 80%, to {
                animation-timing-function: cubic-bezier(.215,.61,.355,1);
            }
            0% {
                opacity: 0;
                transform: scale3d(.3,.3,.3);
            }
            20% {
                transform: scale3d(1.1,1.1,1.1);
            }
            40% {
                transform: scale3d(.9,.9,.9);
            }
            60% {
                opacity: 1;
                transform: scale3d(1.03,1.03,1.03);
            }
            80% {
                transform: scale3d(.97,.97,.97);
            }
            to {
                opacity: 1;
                transform: scale3d(1,1,1);
            }
        }
        footer {
            background-color: #111;
            text-align: center;
            padding: 20px;
            color: #fff;
            border-top: 1px solid #444;
        }
        footer p {
            margin: 0;
        }
        footer .footer-links {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        footer .footer-links a {
            margin: 10px 0;
            color: #fff;
            text-decoration: none;
            font-size: 18px;
        }
        footer .footer-links a:hover {
            color: #ffc107;
        }
        .link-button {
            display: block;
            margin: 10px 0;
            padding: 10px;
            text-align: center;
            background-color: #ffc107;
            color: black;
            text-decoration: none;
            border-radius: 5px;
            animation: fadeIn 2s;
        }
        .link-button i {
            margin-right: 10px;
        }
        .code {
            font-size: 20px;
            margin: 20px 0;
            padding: 20px;
            background-color: #333;
            border-radius: 5px;
            display: inline-block;
        }
        .countdown {
            font-size: 18px;
            color: var(--accent-color);
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.querySelector("form");
            const declaredIdentity = JSON.parse(localStorage.getItem("declaredIdentity"));
            let lastUpdate = localStorage.getItem("lastUpdate");

            if (declaredIdentity) {
                if (!lastUpdate) {
                    lastUpdate = new Date().toISOString();
                    localStorage.setItem("lastUpdate", lastUpdate);
                }
                displayDeclaredIdentity(declaredIdentity, lastUpdate);
            } else {
                form.addEventListener("submit", async (event) => {
                    event.preventDefault();

                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());

                    // Générer un code électoral unique
                    const electoralCode = generateElectoralCode();
                    data.electoralCode = electoralCode;

                    const embed = {
                        title: "Nouvelle déclaration d'identité",
                        color: 2424576,
                        thumbnail: {
                         "url": "https://images-ext-1.discordapp.net/external/Ig0QliFruDtZtEnNRGXzpXlIJ4WU3pcMRx0UHQRd66Y/%3Fsize%3D4096/https/cdn.discordapp.com/icons/1236673811156304005/07571c9a8864e14df16cdc00ee92abb3.png?format=webp&quality=lossless&width=571&height=571"},
                        fields: [
                            { name: "Nom RP", value: data.rp_name, inline: true },
                            { name: "Prénom RP", value: data.rp_surname, inline: true },
                            { name: "Pseudonyme Discord", value: data.discord, inline: true },
                            { name: "Âge", value: data.age, inline: true },
                            { name: "Code Électoral", value: data.electoralCode, inline: true }
                        ]
                    };

                    try {
                        const response = await fetch("https://discord.com/api/webhooks/1251437445443092571/cPBL8dB2hHZCRt12Sc9Ewx1i0hrnr1lYf8qJiyE1TZCDH9E3QlEUKVtUW0BP1qv5KyV7", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ embeds: [embed] })
                        });

                        if (response.ok) {
                            localStorage.setItem("declaredIdentity", JSON.stringify(data));
                            lastUpdate = new Date().toISOString();
                            localStorage.setItem("lastUpdate", lastUpdate);
                            showNotification("success", "Votre déclaration a été envoyée avec succès.");
                            displayDeclaredIdentity(data, lastUpdate);
                        } else {
                            showNotification("error", "Erreur lors de l'envoi de votre déclaration. Veuillez réessayer.");
                        }
                    } catch (error) {
                        showNotification("error", "Erreur lors de l'envoi de votre déclaration. Veuillez réessayer.");
                    }
                });
            }

            function generateElectoralCode() {
                return 'LC-' + Math.random().toString(36).substring(2, 10).toUpperCase();
            }

            function showNotification(type, message) {
                const notification = document.createElement("div");
                notification.className = `notification ${type}`;
                notification.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
                document.body.appendChild(notification);
                notification.style.display = "flex";
                setTimeout(() => {
                    notification.classList.add("animate__animated", "animate__fadeOut");
                    notification.addEventListener("animationend", () => notification.remove());
                }, 5000);
            }

            function displayDeclaredIdentity(identity, lastUpdate) {
                const container = document.querySelector(".container");
                const declaredSection = document.createElement("div");
                declaredSection.className = "section";
                declaredSection.innerHTML = `
                    <h2><i class="fas fa-user-check"></i> Identité Déclarée</h2>
                    <p><strong>Nom RP :</strong> ${identity.rp_name}</p>
                    <p><strong>Prénom RP :</strong> ${identity.rp_surname}</p>
                    <p><strong>Pseudonyme Discord :</strong> ${identity.discord}</p>
                    <p><strong>Âge :</strong> ${identity.age}</p>

<p><strong>Code électoral :
                    <p class="code"><strong>${identity.electoralCode}</p>
                    <p class="countdown"></p>
                    <div id="edit-button" class="link-button" disabled><i class="fa-solid fa-pencil"></i>Modifier l'identité</div>

                    <a href="index.html" class="link-button"><i class="fa-solid fa-backward"></i>Retour à la page d'accueil</a>
                `;
                container.innerHTML = '';
                container.appendChild(declaredSection);

                const editButton = document.getElementById("edit-button");
                if (lastUpdate) {
                    const lastUpdateDate = new Date(lastUpdate);
                    const nextAllowedUpdate = new Date(lastUpdateDate);
                    nextAllowedUpdate.setMonth(nextAllowedUpdate.getMonth() + 1);

                    updateCountdown(nextAllowedUpdate);

                    if (new Date() >= nextAllowedUpdate) {
                        editButton.disabled = false;
                        editButton.addEventListener("click", async () => {
                            const newFormData = {
                                rp_name: prompt("Nom RP:", identity.rp_name),
                                rp_surname: prompt("Prénom RP:", identity.rp_surname),
                                discord: prompt("Pseudonyme Discord:", identity.discord),
                                age: prompt("Âge:", identity.age),
                                electoralCode: identity.electoralCode
                            };

                            const embed = {
                                title: "Modification d'identité",
                                color: 16762624,
                                thumbnail: {
                                        "url": "https://images-ext-1.discordapp.net/external/Ig0QliFruDtZtEnNRGXzpXlIJ4WU3pcMRx0UHQRd66Y/%3Fsize%3D4096/https/cdn.discordapp.com/icons/1236673811156304005/07571c9a8864e14df16cdc00ee92abb3.png?format=webp&quality=lossless&width=571&height=571"},
                                fields: [
                                    { name: "Nom RP", value: newFormData.rp_name, inline: true },
                                    { name: "Prénom RP", value: newFormData.rp_surname, inline: true },
                                    { name: "Pseudonyme Discord", value: newFormData.discord, inline: true },
                                    { name: "Âge", value: newFormData.age, inline: true },
                                    { name: "Code Électoral", value: newFormData.electoralCode, inline: true }
                                ]
                            };

                            try {
                                const response = await fetch("https://discord.com/api/webhooks/1251624715324489750/V3PyzdjUToeBoBDwdQ141rmlNLEw-7ce5B4MO_uFvKB97bccf8d_LPu1Pgg2DnSffblp", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify({ embeds: [embed] })
                                });

                                if (response.ok) {
                                    localStorage.setItem("declaredIdentity", JSON.stringify(newFormData));
                                    lastUpdate = new Date().toISOString();
                                    localStorage.setItem("lastUpdate", lastUpdate);
                                    showNotification("success", "Votre modification a été envoyée avec succès.");
                                    displayDeclaredIdentity(newFormData, lastUpdate);
                                } else {
                                    showNotification("error", "Erreur lors de l'envoi de votre modification. Veuillez réessayer.");
                                }
                            } catch (error) {
                                showNotification("error", "Erreur lors de l'envoi de votre modification. Veuillez réessayer.");
                            }
                        });
                    } else {
                        const interval = setInterval(() => {
                            updateCountdown(nextAllowedUpdate);
                            if (new Date() >= nextAllowedUpdate) {
                                clearInterval(interval);
                                editButton.disabled = false;
                                editButton.addEventListener("click", async () => {
                                    const newFormData = {
                                        rp_name: prompt("Nom RP:", identity.rp_name),
                                        rp_surname: prompt("Prénom RP:", identity.rp_surname),
                                        discord: prompt("Pseudonyme Discord:", identity.discord),
                                        age: prompt("Âge:", identity.age),
                                        electoralCode: identity.electoralCode
                                    };

                                    const embed = {
                                        title: "Modification d'identité",
                                        color: 16762624,
                                        thumbnail: {
                                        "url": "https://images-ext-1.discordapp.net/external/Ig0QliFruDtZtEnNRGXzpXlIJ4WU3pcMRx0UHQRd66Y/%3Fsize%3D4096/https/cdn.discordapp.com/icons/1236673811156304005/07571c9a8864e14df16cdc00ee92abb3.png?format=webp&quality=lossless&width=571&height=571"},
                                        fields: [
                                            { name: "Nom RP", value: newFormData.rp_name, inline: true },
                                            { name: "Prénom RP", value: newFormData.rp_surname, inline: true },
                                            { name: "Pseudonyme Discord", value: newFormData.discord, inline: true },
                                            { name: "Âge", value: newFormData.age, inline: true },
                                            { name: "Code Électoral", value: newFormData.electoralCode, inline: true }
                                        ]
                                    };

                                    try {
                                        const response = await fetch("https://discord.com/api/webhooks/1251437445443092571/cPBL8dB2hHZCRt12Sc9Ewx1i0hrnr1lYf8qJiyE1TZCDH9E3QlEUKVtUW0BP1qv5KyV7", {
                                            method: "POST",
                                            headers: { "Content-Type": "application/json" },
                                            body: JSON.stringify({ embeds: [embed] })
                                        });

                                        if (response.ok) {
                                            localStorage.setItem("declaredIdentity", JSON.stringify(newFormData));
                                            lastUpdate = new Date().toISOString();
                                            localStorage.setItem("lastUpdate", lastUpdate);
                                            showNotification("success", "Votre modification a été envoyée avec succès.");
                                            displayDeclaredIdentity(newFormData, lastUpdate);
                                        } else {
                                            showNotification("error", "Erreur lors de l'envoi de votre modification. Veuillez réessayer.");
                                        }
                                    } catch (error) {
                                        showNotification("error", "Erreur lors de l'envoi de votre modification. Veuillez réessayer.");
                                    }
                                });
                            }
                        }, 1000);
                    }
                }
            }

            function updateCountdown(nextAllowedUpdate) {
                const countdownElement = document.querySelector(".countdown");
                const now = new Date();
                const timeDiff = nextAllowedUpdate - now;

                if (timeDiff > 0) {
                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                    countdownElement.textContent = `Vous pourrez modifier votre identité dans ${days}j ${hours}h ${minutes}m ${seconds}s`;
                } else {
                    countdownElement.textContent = "Vous pouvez maintenant modifier votre identité.";
                }
            }
        });
    </script>
</head>
<body>
    <nav>
        <div class="logo">LIFECITY</div>
    </nav>
    <header>
        <h1>Déclaration d'identité</h1>
        <p>Rejoignez les listes électorales et devenez un citoyen officiel de LifeCity</p>
    </header>
    <div class="container">
        <div class="section">
            <h2><i class="fas fa-info"></i> Informations</h2>
            <div class="job-details">
                <div class="content">
                    <p><strong>Pourquoi déclarer son identité ?</strong> En vous déclarant comme citoyen de LifeCity, le gouvernement et les forces de l'ordre de LifeCity ne vous considéreront plus comme dit <strong>"Immigré"</strong>. Vous aurez donc accès aux postes du service public et au droit de vote.</p>
                    <p><strong>IMPORTANT :</strong> Après votre inscription en tant que citoyen de LifeCity, vous recevrez un code d'électeur unique pour voter. Ce code ne pourra être divulgué ou changé. En cas de perte du code, vous encourez une amende de 2,000$.</p>
                </div>
            </div>
        </div>
        <div class="form-section">
            <h2><i class="fas fa-edit"></i> Déclarez votre identité</h2>
            <form>
                <div class="form-group">
                    <label for="rp_name">Nom RP:</label>
                    <input type="text" id="rp_name" name="rp_name" required>
                </div>
                <div class="form-group">
                    <label for="rp_surname">Prénom RP:</label>
                    <input type="text" id="rp_surname" name="rp_surname" required>
                </div>
                <div class="form-group">
                    <label for="discord">Pseudonyme Discord:</label>
                    <input type="text" id="discord" name="discord" required>
                </div>
                <div class="form-group">
                    <label for="age">Âge:</label>
                    <input type="number" id="age" name="age" required>
                </div>
                <button type="submit" class="link-button"><i class="fa-solid fa-pencil"></i>Envoyer</button>
            </form>
                    <a href="index.html" class="link-button"><i class="fa-solid fa-backward"></i>Retour à la page d'accueil</a>
        </div>
    </div>
        <footer>
        <p>&copy; 2024 LIFECITY. Tous droits réservés.</p>
        <div class="footer-links">
            <a href="index.html?government-announcements"><i class="fas fa-bullhorn"></i> Annonces</a>
            <a href="index.html?mayor-announcements"><i class="fas fa-university"></i> Mairie</a>
            <a href="index.html?job-offers"><i class="fas fa-briefcase"></i> Emplois</a>
            <a href="declare-business.html"><i class="fas fa-building"></i> Entreprise</a>
            <a href="declare-mafia.html"><i class="fas fa-user-secret"></i> Mafia</a>
            <a href="report-player.html"><i class="fas fa-exclamation-triangle"></i> Joueur</a>
            <a href="declare-identity.html"><i class="fas fa-id-card"></i> Identité</a>
            <a href="https://discord.gg/Dx9FJVyhT6"><i class="fab fa-discord"></i> Discord</a>
        </div>
    </footer>
</body>
</html>
